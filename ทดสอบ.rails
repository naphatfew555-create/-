<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤ Firebase)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö input ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: border-color 0.2s;
        }
        .form-input:focus {
            border-color: #dc2626; /* focus:ring-red-500 */
            outline: none;
            box-shadow: 0 0 0 1px #dc2626;
        }
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö input file */
        .file-input-style {
            file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 
            file:text-sm file:font-semibold file:bg-gray-200 file:text-gray-700 
            hover:file:bg-gray-300 cursor:pointer focus:ring-red-500 focus:border-red-500
        }
    </style>
</head>
<body class="bg-gray-100 flex justify-center py-10 min-h-screen">

    <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4 shadow-2xl">
        
        <h2 class="text-3xl font-bold mb-8 text-center text-red-700">
            üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£
        </h2>

        <form onsubmit="registerRestaurant(event)">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">

                <div class="col-span-full border-b border-gray-200 pb-6 mb-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800 border-l-4 border-red-500 pl-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
                    
                    <div class="mb-4">
                        <label class="block text-base font-medium mb-1 text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô *</label>
                        <input name="name" type="text" required class="form-input">
                    </div>

                    <div class="mb-4">
                        <label class="block text-base font-medium mb-1 text-gray-700">‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</label>
                        <div class="flex space-x-2">
                            <select name="joinDay" id="joinDay" required class="flex-1 form-input">
                                <option value="">‡∏ß‡∏±‡∏ô</option>
                            </select>
                            <select name="joinMonth" id="joinMonth" required class="flex-1 form-input">
                                <option value="">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                            </select>
                            <select name="joinYear" id="joinYear" required class="flex-1 form-input">
                                <option value="">‡∏õ‡∏µ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="col-span-full border-b border-gray-200 pb-6 mb-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800 border-l-4 border-red-500 pl-3">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏£‡∏≤‡∏Ñ‡∏≤</h3>
                    
                    <div class="mb-4">
                        <label class="block text-base font-medium mb-1 text-gray-700">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô *</label>
                        <select name="cuisineType" required class="form-input">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                            <option value="A la carte">A la carte (‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á)</option>
                            <option value="Buffet">Buffet (‡∏ö‡∏∏‡∏ü‡πÄ‡∏ü‡πà‡∏ï‡πå)</option>
                            <option value="Both">‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÅ‡∏ö‡∏ö</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="block text-base font-medium mb-1 text-gray-700">‡∏£‡∏≤‡∏Ñ‡∏≤ *</label>
                        <textarea name="priceRange" required placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÄ‡∏ä‡πà‡∏ô&#10;- ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà 299 ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏ô&#10;- ‡πÄ‡∏î‡πá‡∏Å 199 ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏ô" rows="4" class="form-input resize-none"></textarea>
                    </div>

                    <div>
                        <label class="block text-base font-medium mb-1 text-gray-700">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏£‡πâ‡∏≤‡∏ô</label>
                        <textarea name="conditions" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏ô‡∏•‡∏∞ 100 ‡∏ö‡∏≤‡∏ó" rows="3" class="form-input resize-none"></textarea>
                    </div>
                </div>

                <div class="col-span-full border-b border-gray-200 pb-6 mb-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800 border-l-4 border-red-500 pl-3">‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</h3>
                    
                    <label class="block text-base font-medium mb-3 text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î - ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô</label>
                    <div class="flex items-center space-x-4 mb-2">
                        <input name="openingTime" id="restOpenTime" type="time" class="flex-1 form-input">
                        <span class="text-gray-500">-</span>
                        <input name="closingTime" id="restCloseTime" type="time" class="flex-1 form-input">
                    </div>
                    <div>
                        <input type="checkbox" id="open24Hours" name="open24Hours" class="rounded text-red-600 focus:ring-red-500">
                        <label for="open24Hours" class="text-sm text-gray-700">‡πÄ‡∏õ‡∏¥‡∏î 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</label>
                    </div>

                    <div class="mt-6">
                        <label class="block text-base font-medium mb-3 text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô</label>
                        <div class="border border-green-300 bg-green-50 p-4 rounded-lg mb-4">
                            <label class="inline-flex items-center font-bold text-green-700">
                                <input type="checkbox" id="openEveryDay" name="openEveryDay" class="rounded text-green-600 focus:ring-green-500 mr-1">
                                ‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
                            </label>
                        </div>
                        <div id="daysCheckboxes" class="grid grid-cols-2 sm:grid-cols-4 gap-y-2">
                            <label class="inline-flex items-center"><input type="checkbox" name="daysOpen[]" value="‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå" class="rounded text-red-600 focus:ring-red-500 mr-1"> ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</label>
                            <label class="inline-flex items-center"><input type="checkbox" name="daysOpen[]" value="‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£" class="rounded text-red-600 focus:ring-red-500 mr-1"> ‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</label>
                            <label class="inline-flex items-center"><input type="checkbox" name="daysOpen[]" value="‡∏û‡∏∏‡∏ò" class="rounded text-red-600 focus:ring-red-500 mr-1"> ‡∏û‡∏∏‡∏ò</label>
                            <label class="inline-flex items-center"><input type="checkbox" name="daysOpen[]" value="‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ" class="rounded text-red-600 focus:ring-red-500 mr-1"> ‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</label>
                            <label class="inline-flex items-center"><input type="checkbox" name="daysOpen[]" value="‡∏®‡∏∏‡∏Å‡∏£‡πå" class="rounded text-red-600 focus:ring-red-500 mr-1"> ‡∏®‡∏∏‡∏Å‡∏£‡πå</label>
                            <label class="inline-flex items-center"><input type="checkbox" name="daysOpen[]" value="‡πÄ‡∏™‡∏≤‡∏£‡πå" class="rounded text-red-600 focus:ring-red-500 mr-1"> ‡πÄ‡∏™‡∏≤‡∏£‡πå</label>
                            <label class="inline-flex items-center"><input type="checkbox" name="daysOpen[]" value="‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå" class="rounded text-red-600 focus:ring-red-500 mr-1"> ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</label>
                        </div>
                    </div>
                </div>

                <div class="col-span-full border-b border-gray-200 pb-6 mb-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800 border-l-4 border-red-500 pl-3">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á</h3>
                    
                    <div class="mb-4">
                        <label class="block text-base font-medium mb-1 text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô *</label>
                        <input name="phoneNumber" type="tel" required class="form-input">
                    </div>

                    <div class="mb-4">
                        <label class="block text-base font-medium mb-1 text-gray-700">‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏£‡πâ‡∏≤‡∏ô *</label>
                        <textarea name="address" required rows="4" class="form-input resize-none"></textarea>
                    </div>

                    <div class="mb-4">
                        <label class="block text-base font-medium mb-1 text-gray-700">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á Google Maps</label>
                        <input name="googleMapsLink" type="url" placeholder="URL ‡∏Ç‡∏≠‡∏á Google Maps" class="form-input">
                    </div>

                    <div>
                        <label class="block text-base font-medium mb-1 text-gray-700">‡∏•‡∏¥‡∏á‡∏Å‡πå Facebook (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                        <input name="facebookLink" type="url" placeholder="https://facebook.com/..." class="form-input">
                    </div>
                </div>

                <div class="col-span-full border-b border-gray-200 pb-6 mb-4">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800 border-l-4 border-red-500 pl-3">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏£‡πâ‡∏≤‡∏ô</h3>
                    <label class="block text-base font-medium mb-1 text-gray-700">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏£‡πâ‡∏≤‡∏ô (‡πÅ‡∏ô‡∏ö‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 30 ‡∏£‡∏π‡∏õ) *</label>
                    <input name="images" type="file" multiple accept="image/*" required class="w-full p-3 border border-gray-300 rounded-lg file-input-style">
                    <p class="text-xs text-gray-500 mt-1">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</p>
                </div>

                <div class="col-span-full pt-6">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800 border-l-4 border-red-500 pl-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-base font-medium mb-1 text-gray-700">‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
                            <input name="email" type="email" required class="form-input">
                        </div>
                        <div>
                            <label class="block text-base font-medium mb-1 text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô *</label>
                            <input name="password" type="password" required class="form-input">
                        </div>
                        <div>
                            <label class="block text-base font-medium mb-1 text-gray-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô *</label>
                            <input name="confirmPassword" type="password" required class="form-input">
                            <div id="restPasswordError" class="text-red-500 text-sm mt-1 hidden">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô</div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="flex space-x-4 mt-8">
                <button type="submit" class="flex-1 text-white font-bold py-3 rounded-lg shadow-md bg-red-700 hover:bg-red-800 transition duration-150">
                    ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡πâ‡∏≤‡∏ô
                </button>
                <button type="button" onclick="window.location.reload()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 rounded-lg transition duration-150">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å / ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                </button>
            </div>
        </form>
    </div>

<script>
// =========================================================
// === FIREBASE CONFIGURATION & INIT (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) ===
// =========================================================
const firebaseConfig = {
    apiKey: "AIzaSyCf9n879y-0KmwZ6MB-fPHH2el9SW3ostg", // <-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô apiKey ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    authDomain: "kinhoncnx.firebaseapp.com",
    projectId: "kinhoncnx",
    storageBucket: "kinhoncnx.firebasestorage.app",
    messagingSenderId: "771596037544",
    appId: "1:771596037544:web:a48581dc40d82c1867c19d",
    measurementId: "G-5DSS0LFEQZ"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();
const auth = firebase.auth();

let restaurants = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ã‡πâ‡∏≥

// =========================================================
// === UI HELPER FUNCTIONS (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤ Dropdown ‡πÅ‡∏•‡∏∞ Checkbox) ===
// =========================================================
document.addEventListener('DOMContentLoaded', () => {
    const daySelect = document.getElementById('joinDay');
    const monthSelect = document.getElementById('joinMonth');
    const yearSelect = document.getElementById('joinYear');
    
    // Days (1-31)
    for (let i = 1; i <= 31; i++) {
        const day = i.toString().padStart(2, '0');
        daySelect.innerHTML += `<option value="${day}">${day}</option>`;
    }

    // Months (1-12)
    const thaiMonths = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];
    thaiMonths.forEach((month, index) => {
        monthSelect.innerHTML += `<option value="${index + 1}">${month}</option>`;
    });

    // Years (10 ‡∏õ‡∏µ ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á)
    const currentYear = new Date().getFullYear();
    for (let i = 0; i < 10; i++) {
        const year = currentYear - i;
        yearSelect.innerHTML += `<option value="${year}">${year}</option>`;
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ã‡πâ‡∏≥
    loadDataFromFirebase();
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
document.getElementById('open24Hours').addEventListener('change', function() {
    const openTime = document.getElementById('restOpenTime');
    const closeTime = document.getElementById('restCloseTime');

    if (this.checked) {
        openTime.value = '00:00';
        closeTime.value = '23:59';
        openTime.disabled = true;
        closeTime.disabled = true;
    } else {
        openTime.value = '';
        closeTime.value = '';
        openTime.disabled = false;
        closeTime.disabled = false;
    }
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
document.getElementById('openEveryDay').addEventListener('change', function() {
    const daysCheckboxes = document.getElementById('daysCheckboxes').querySelectorAll('input[type="checkbox"]');
    daysCheckboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
        checkbox.disabled = this.checked;
    });
});


// =========================================================
// === FIREBASE HELPER FUNCTIONS (‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ===
// =========================================================

async function loadDataFromFirebase() {
    try {
        const restaurantsSnapshot = await db.collection('restaurants').get();
        restaurants = restaurantsSnapshot.docs.map(doc => doc.data());
    } catch (err) {
        console.error('Error loading restaurant data:', err);
    }
}

async function uploadImage(file, path) {
    try {
        const storageRef = storage.ref().child(path);
        const snapshot = await storageRef.put(file);
        const downloadURL = await snapshot.ref.getDownloadURL();
        return downloadURL;
    } catch (error) {
        console.error('Error uploading image:', error);
        return null;
    }
}

async function uploadMultipleImages(files, restaurantId) {
    const uploadPromises = [];
    const imageUrls = [];

    if (files.length > 30) {
        alert("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 30 ‡∏£‡∏π‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!");
        return [];
    }
    
    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const path = `restaurant_images/${restaurantId}/${Date.now()}_${file.name}`;
        
        const promise = uploadImage(file, path).then(url => {
            if (url) {
                imageUrls.push(url);
            }
        });
        uploadPromises.push(promise);
    }

    await Promise.all(uploadPromises);
    return imageUrls;
}

async function saveUserToFirebase(userData) {
    try {
        await db.collection('users').doc(userData.id.toString()).set(userData);
        return true;
    } catch (err) {
        console.error(err);
        return false;
    }
}

async function saveRestaurantToFirebase(restaurantData) {
    try {
        // ‡πÉ‡∏ä‡πâ set() ‡πÅ‡∏ó‡∏ô add() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î ID ‡∏à‡∏≤‡∏Å Firestore ‡∏Å‡πà‡∏≠‡∏ô
        await db.collection('restaurants').doc(restaurantData.id.toString()).set(restaurantData);
        return true;
    } catch (err) {
        console.error(err);
        return false;
    }
}


// =========================================================
// === FUNCTION REGISTER RESTAURANT (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ===
// =========================================================

async function registerRestaurant(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = {};
    const daysOpenArr = [];

    // 1. ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    for (let [key, value] of formData.entries()) {
        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Checkbox ‡∏Ç‡∏≠‡∏á daysOpen[] ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤
        if (key === 'daysOpen[]') {
            daysOpenArr.push(value); 
        } else {
            data[key] = value;
        }
    }
    
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ daysOpen ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
    data.daysOpen = '';
    if (data.openEveryDay === 'on' || daysOpenArr.length === 7) {
        data.daysOpen = '‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô';
    } else if (daysOpenArr.length > 0) {
        data.daysOpen = daysOpenArr.join(', ');
    }


    const password = data.password;
    const confirmPassword = data.confirmPassword;
    const email = data.email;
    const images = form.elements['images'].files;

    // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
    if (password !== confirmPassword) {
        document.getElementById('restPasswordError').classList.remove('hidden');
        alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
        return;
    }
    document.getElementById('restPasswordError').classList.add('hidden');

    // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÇ‡∏î‡∏¢‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
    if (restaurants.some(r => r.email === email)) { 
        alert('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
        return;
    }
    
    // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏´‡∏•‡∏î
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô...';
    submitBtn.disabled = true;
    
    try {
        // 5. ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Firebase Auth ‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•/‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const uid = userCredential.user.uid;

        // 6. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î ID ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        const newRestaurantId = db.collection('restaurants').doc().id; 
        const imageUrls = await uploadMultipleImages(images, newRestaurantId);
        
        if (images.length > 0 && imageUrls.length === 0) {
            throw new Error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");
        }
        
        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
        const joinDate = `${data.joinYear}-${data.joinMonth.toString().padStart(2, '0')}-${data.joinDay.toString().padStart(2, '0')}`;

        // 7. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
        const restaurantData = {
            id: newRestaurantId,
            uid: uid,
            name: data.name,
            joinDate: joinDate,
            email: email,
            cuisineType: data.cuisineType,
            priceRange: data.priceRange, 
            conditions: data.conditions || '',
            phoneNumber: data.phoneNumber,
            address: data.address,
            googleMapsLink: data.googleMapsLink || '',
            facebookLink: data.facebookLink || '',
            openingTime: data.open24Hours === 'on' ? '00:00' : data.openingTime || '',
            closingTime: data.open24Hours === 'on' ? '23:59' : data.closingTime || '',
            open24Hours: data.open24Hours === 'on',
            daysOpen: data.daysOpen, // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß
            images: imageUrls,
            status: 'pending', 
            role: 'restaurant',
            createdAt: new Date().toISOString()
        };
        
        // 8. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á Firestore
        await saveRestaurantToFirebase(restaurantData);

        // 9. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô)
        const userData = {
            id: uid,
            email: email,
            role: 'restaurant',
            restaurantId: newRestaurantId,
            createdAt: new Date().toISOString()
        };
        await saveUserToFirebase(userData);
        
        alert('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏î‡∏¢‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà');
        
        form.reset();
        loadDataFromFirebase(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

    } catch (error) {
        console.error("Error during restaurant registration:", error);
        
        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Firebase Auth Error
        if (error.code === 'auth/email-already-in-use') {
            alert('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Firebase ‡πÅ‡∏•‡πâ‡∏ß');
        } else if (error.code === 'auth/weak-password') {
             alert('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
        } else {
            alert(`‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å'}`);
        }
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
}
</script>
</body>
</html>